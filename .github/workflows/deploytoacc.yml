
name: PromotetoCI

on:
 
  push:
    branches: CI
  
jobs:
    deploy-acc:
        runs-on: ubuntu-latest
        steps:
        # Checkout the source code
            - name: 'Checkout source code'
              uses: actions/checkout@v2
        # Install Salesforce CLI
            - name: 'Install Salesforce CLI'
              run: |
                  wget https://developer.salesforce.com/media/salesforce-cli/sfdx/channels/stable/sfdx-linux-x64.tar.xz
                  mkdir ~/sfdx
                  tar xJf sfdx-linux-x64.tar.xz -C ~/sfdx --strip-components 1
                  echo "$HOME/sfdx/bin" >> $GITHUB_PATH
                  ~/sfdx/bin/sfdx version
                  
        # Store secret for acc org
        #    - name: 'Populate auth file with ACC_SFDX_URL secret'
        #      shell: bash
        #      run: |
        #          echo ${{ secrets.ACC_SFDX_URL}} > ./ACC_SFDX_URL.txt
        #          secretFileSize=$(wc -c "./ACC_SFDX_URL.txt" | awk '{print $1}')
        #          if [ $secretFileSize == 1 ]; then
        #              echo "Missing ACC_SFDX_URL secret. Is this workflow running on a fork?";
        #              exit 1;
        #          fi
            # Authenticate Org
            - name: 'Authenticate CI Org'
              run: sfdx force:auth:jwt:grant --clientid 3MVG9fe4g9fhX0E7Dy5LJtO93WCIHHA0Lsi9uOW5hG3RVbzSsjSB_HmDLIJnUiN.W4xJjFbtW92uXaGbYImnf --jwtkeyfile server.key --username anig2989@gmail.com --instanceurl https://login.salesforce.com 

              
            # Deploy source to CI Org
            - name: 'Push source to Acc org'
              run: sfdx force:source:deploy -c -u anig2989@gmail.com -p force-app/main/default

   
